<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: transport/eve.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: transport/eve.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var eve = require("evejs"),
    config = require("../config/config.js")

eve.system.init({
    transports: config.transports
})



/**
 * Agent Adapter to use Eve Agent Framework as Base Class
 * 
 * @param {any} id 
 * @param {any} options 
 */
EveAgentTransport = function (id, options) {
    eve.Agent.call(this, id);
    console.log("Create Eve Transport Plugin")
    this.id = id;
    this._events = {};
    this.extend('request');
    this.connect(eve.system.transports.getAll());
}
EveAgentTransport.prototype = Object.create(eve.Agent.prototype);
EveAgentTransport.prototype.constructor = EveAgentTransport;


/**
 * Add Event Listener
 * 
 * @param {any} event 
 * @callback callback 
 */
EveAgentTransport.prototype.on = function(event, callback) {

    if (this._events[event] === undefined) {
        this._events[event] = [];
        var topic = this.id + "." + event
        //console.log(this.id, "subscribe to", topic)
    }

    this._events[event].push(callback);
}

/**
 * Remove EventListener
 * 
 * @param {any} event 
 * @callback callback 
 */
EveAgentTransport.prototype.off = function(event, callback) {
    if (this._events[event] !== undefined) {
        var idx = this._events[event].indexOf(callback);
        if (idx >= 0) {
            this._events[event].splice(idx, 1);
        }
        if (this._events[event].length = 0) {
            delete this._events[event];
            client.sub.unsubscribe(this.id + "." + event);
        }

    }
}


/**
 * send message via Eve Agent Framework
 * 
 * @param {any} rec 
 * @param {any} type 
 * @param {any} message 
 */
EveAgentTransport.prototype.sendMessage = function(rec, type, message) {
    var data = {
        sender: this.id,
        message: message,
        event: type
    };
    var d = JSON.stringify(data);
    var topic = rec + "." + type;
    this.send(rec,d);
    //console.log(this.id, "publish to", topic, message)
};

function _onError(err) {
    console.log("Error " + err);
}



EveAgentTransport.prototype.receive = function(from, message) {
    var data = JSON.parse(message);
    //console.log("receive Message", from, data);
    var event = data.event;

    if (this._events[event] !== undefined) {
        var callbacks = this._events[event];
        for (var i = 0; i &lt; callbacks.length; i++) {
            try {
                var callback = callbacks[i];
                callback.call(this, from, data.message);
            } catch (error) {
                console.log("Error executing message Handler")
            }
            
            //callback(data.sender, data.message);
        }
    }

}


module.exports = EveAgentTransport;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Ant.html">Ant</a></li><li><a href="Cell.html">Cell</a></li><li><a href="Environment.html">Environment</a></li><li><a href="Manager.html">Manager</a></li><li><a href="WorkerNode.html">WorkerNode</a></li></ul><h3>Global</h3><ul><li><a href="global.html#EveAgentTransport">EveAgentTransport</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Jun 15 2017 18:16:21 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
